<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.campus.activity.mapper.user.ActivityManagerMapper">

    <!-- 分页多条件查询 -->
    <select id="selectActivityManagerPage" resultType="com.campus.activity.entity.user.ActivityManager">
        SELECT
        id, username, name, dept_id, dept_name, major, phone,
        qualification_status, status, manage_activity_count, create_time
        FROM activity_manager
        <where>
            <if test="query.username != null and query.username != ''">
                AND username LIKE CONCAT('%', #{query.username}, '%')
            </if>
            <if test="query.name != null and query.name != ''">
                AND name LIKE CONCAT('%', #{query.name}, '%')
            </if>
            <if test="query.deptId != null">
                AND dept_id = #{query.deptId}
            </if>
            <if test="query.qualificationStatus != null">
                AND qualification_status = #{query.qualificationStatus}
            </if>
            <if test="query.status != null">
                AND status = #{query.status}
            </if>
            <if test="query.startTime != null">
                AND create_time &gt;= #{query.startTime}
            </if>
            <if test="query.endTime != null">
                AND create_time &lt;= #{query.endTime}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <!-- 按账号查询 -->
    <select id="selectByUsername" resultType="com.campus.activity.entity.user.ActivityManager">
        SELECT id, username, password, name, status, qualification_status
        FROM activity_manager
        WHERE username = #{username}
    </select>

    <!-- 按院系ID查询（仅启用状态） -->
    <select id="selectByDeptId" resultType="com.campus.activity.entity.user.ActivityManager">
        SELECT id, username, name, phone, qualification_status, status
        FROM activity_manager
        WHERE dept_id = #{deptId}
        <if test="qualificationStatus != null">
            AND qualification_status = #{qualificationStatus}
        </if>
        AND status = 1
        ORDER BY create_time DESC
    </select>

    <!-- 资质审核 -->
    <update id="updateQualificationStatus">
        UPDATE activity_manager
        SET
            qualification_status = #{qualificationStatus},
            reject_reason = #{rejectReason},
            update_time = NOW()
        WHERE id = #{id}
    </update>

    <!-- 更新负责活动数 -->
    <update id="updateManageActivityCount">
        UPDATE activity_manager
        SET
            manage_activity_count = #{count},
            update_time = NOW()
        WHERE id = #{id}
    </update>

</mapper>